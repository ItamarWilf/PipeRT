#!/bin/bash

redis-cli -h vlad_redis flushall
sleep 1

REDIS_URL=${REDIS_URL:='redis://vlad_redis:6379'}

python -m pipert.contrib.flask_display -u "$REDIS_URL" -i camera:0 -m camera:2 -z 4246 &
PID1=$!
python -m pipert.contrib.yolov3 -u "$REDIS_URL" -i camera:0 -o camera:2 -z 4243 &
PID4=$!
#python -m pipert.contrib.sort -u "$REDIS_URL" -i camera:2 -o camera:3 -z 4247 --max-age 10 --window-size 10 --percent-seen 0.6 &
#PID6=$!
#python -m pipert.contrib.video_writer -z 4248 &
#PID9=$!
sleep 5
python -m pipert.contrib.vid_capture -i "pipert/test.mp4" -u "$REDIS_URL" &
PID5=$!

read -p "Press enter in order to shut down the pipeline " stam

kill $PID1
kill $PID4
kill $PID5
#kill $PID6
#kill $PID9

sleep 5
kill -9 $PID1
kill -9 $PID4
kill -9 $PID5
#kill -9 $PID6
#kill -9 $PID9